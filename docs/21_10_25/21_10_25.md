# 21 Oct 2025 – Visual Differential Snapshot

## Context
- Clone pipeline remains the sole path (AutoPPTX disabled). Latest committed build: `output/presentations/run_20251021_102357/GeneratedDeck_20251021_102357.pptx` generated via `python -m amp_automation.cli.main --excel template/BulkPlanData_2025_10_14.xlsx --template template/Template_V4_FINAL_071025.pptx --output "GeneratedDeck_{timestamp}.pptx"`.
- Differential pack regenerated by the external analyst now targets the correct deck and template. Source artifacts: `docs/21_10_25/differential_visual_analysis/` (README, Quick Reference, LLM Fix Instructions, Complete Forensic Analysis, Technical Methodology + supporting PPTX).
- Visual diff probe (`tools/visual_diff.py --reference template/Template_V4_FINAL_071025.pptx --generated output/presentations/run_20251021_102357/GeneratedDeck_20251021_102357.pptx --keep-exports --max-slides 1 --output-dir output/visual_diff/run_20251021_102357_slide1`) still reports Slide 1 mean 195.45 / RMS 213.45. Captures live beside the diff run.

## Confirmed Matches vs Template
- Slide size is 10.00″ × 5.625″ (9 144 000 EMU × 5 143 500 EMU).
- Table position matches template exactly: left 163 582 EMU, top 638 117 EMU, width ≈ 8.531 M EMU, height ≈ 3.766 M EMU (differences < 0.003 %).
- Font family/sizes align (header Verdana 7.5 pt, body Verdana 7.0 pt).
- No overflow beyond slide bounds; continuation logic and validator contract satisfied.

## Outstanding Gaps (per forensic + local diff)
1. **Row heights** — header is 127 101 EMU (should be 161 729 EMU); most body rows are 107 899 EMU (template 99 205 EMU). 32/35 rows off.  
2. **Text alignment** — template centers every cell; generated deck retains LEFT/RIGHT split. ~601 cells affected.  
3. **Legend duplication** — Slide 1 in the template omits the legend block; clone slide retains synthesized legend shapes (indices 12‑19).  
4. **Column widths** — off by ≤ 252 EMU overall (≃0.0003″). Snapping to the template’s width list will eliminate residual drift.

## Recommended Fix Sequence
1. Apply template row heights verbatim (row 0 = 161 729; rows 1‑33 = 99 205; row 34 = 0).  
2. Force `PP_ALIGN.CENTER` on all table paragraphs post-population.  
3. Prune legend shapes on slides where the template does not include the group.  
4. Reapply template column widths (18-entry EMU list).  
5. Regenerate deck, rerun diff/validator/pytest, then capture fresh template PNGs + multi-slide baseline for Zen MCP/Compare.

## Artefacts
- Differential bundle: `docs/21_10_25/differential_visual_analysis/`
- Local JSON diff (template vs `GeneratedDeck_20251021_102357.pptx`): `docs/21_10_25/differential_visual_analysis/local_diff_report.json`
- Visual diff export: `output/visual_diff/run_20251021_102357_slide1/`
- Latest passing deck: `output/presentations/run_20251021_102357/GeneratedDeck_20251021_102357.pptx`
- Regression fixture (missing grand totals): `output/presentations/run_20251020_124516/GeneratedDeck_Task11_fixed.pptx`

## Next Milestones
1. Land row-height/alignment/legend/width fixes; regenerate Slide 1.  
2. Acquire multi-slide template baseline and rerun full-deck visual diff.  
3. Execute Zen MCP + PowerPoint Compare with archived evidence.  
4. Extend pytest coverage (summary tile typography, legend rebuild, clone toggle).  
5. Run `scripts/run_pipeline_local.py` on additional markets to validate the 32-row contract.  
6. Review final baseline deck count with Alex once visual parity is signed off.
